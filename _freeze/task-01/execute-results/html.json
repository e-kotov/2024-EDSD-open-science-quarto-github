{
  "hash": "02512144ec8af0934d831817a20146a9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"1. Workshop Task\"\n---\n\n\n\n\nYour task is to create a reproducible summary report with key statistics and a flowmap using the [Scholarly Migration Database](https://www.scholarlymigration.org/){target=\"_blank\"}. This is a beginner level task. \n\nIf you are feeling especially confident, you can use the data from the [The Human Migration Database](https://github.com/MaciejDanko/HMigD_Shiny_App_I), which you can download via the interactive [web app](https://maciej-jan-danko.shinyapps.io/HMigD_Shiny_App_I/) (see last the tab for downloads). Warning: this is likely take more time than with the Scholarly Migration Database, as there are more data columns and you will spend more time reading the codebook. So only go for this task if the R programming part and Quarto are easy for your.\n\n# Final goal\n\nThe final goal is to have a repository on GitHub with:\n  \n  - a reproducible Quarto (`*.qmd`) document in the root of the repository\n  \n  - an `html` file created from the `*.qmd` file above in the `docs` folder of the repository\n  \n  - a `README.md` file in the root of the repository that briefly describes the project (e.g. specifies that this is an assignment done as part of EDSD linking back to EDSD website, or to this workshop materials, etc. )\n\nRequirements:\n\n  - The Quarto document can be rendered without errors into an `html` file\n\n  - The document contains R code to load the data and perform any neccessary data transformation for visualisation. Instead of commenting the code, use plain or markdown-formatted text outside the code blocks.\n\n  - The document contains at least two figures summarizing the flows data (e.g. a histogram, a scatter plot, etc.)\n\n  - The document contains a flowmap\n\n  - The document layout uses some of the custom figure placement options from [Article Layout](https://quarto.org/docs/authoring/article-layout.html){target=\"_blank\"}.\n\n\n# Step by step instructions\n\nMake sure you went through the [setup steps](00-setup.qmd), and therefore have all the tools and a GitHub account.\n\n## 1. Cloning the repository\n\n### 1.1. Clone using your GitHub account\n\n1. Go to the repository of the [Scholarly Migration Database](https://github.com/MPIDR/Global-flows-and-rates-of-international-migration-of-scholars/){target=\"_blank\"} and \"Fork\" it into your GitHub account.\n\n![](media/images/fork-smd.png)\n\n2. Open `RStudio` and create a new project.\n\n    2.1. Choose \"Version Control\":\n\n    ![](media/images/git-clone-rstudio-001.png)\n\n    2.2. Choose \"Git\" as your version control system:\n\n    ![](media/images/git-clone-rstudio-002.png)\n\n    2.3. Copy the link to your repository from the web and paste it in the prompt:\n\n    ![](media/images/git-clone-rstudio-003.png)\n\n    2.4. If this is your first time using git and GitHub on this computer, you should get a prompt like this:\n\n    ![](media/images/git-clone-rstudio-004.png)\n\n    *You may not get this prompt if the repository you are downloading is public (which in this case when you have created a fork, it is). You will get this prompt when you try to push (upload) any changes you make in the repository back to GitHub.*\n    \n    You should choose the blue button **\"Sign in with your browser\"**.\n\n    2.5. Complete the authentication in the web browser with your GitHub account:\n\n    ![](media/images/git-clone-rstudio-005.png)\n\n\nYou only need to do this once, as this sets up your local `git` installation to use your GitHub acccount. So when you work with another online repository, you should just be able to access it without those extra steps.\n\n### 1.2. Fallback if everything else fails, just download the repository\n\nIf nothing works for you, feel free to just download the [Scholarly Migration Database](https://github.com/MPIDR/Global-flows-and-rates-of-international-migration-of-scholars/){target=\"_blank\"} repository manually.\n\n![](media/images/download-repo.png)\n\n## 2. Explore the data\n\n1. Create a new Quarto document in the root folder of the cloned or downloaded repository:\n\nEither in the top left of RStudio:\n\n![](media/images/new-quarto-doc.png)\n\nOr in the bottom right in the Files pane:\n\n![](media/images/new-quarto-doc-file-pane.png)\n\n2. Using the basic R and Quarto syntax (see [intro reference of basic Quarto syntax here](https://quarto.org/docs/get-started/computations/rstudio.html){target=\"_blank\"}), list the packages you need to be loaded in the first chunk/block of code.\n\n3. Add more chunks/blocks of code to load the data (you may use either **openalex_2024_V1_scholarlymigration_countryflows_enriched.csv** or **scopus_2024_V1_scholarlymigration_countryflows_enriched.csv**) and explore it. You may ignore the code visibility options for now. Just leave default options for code blocks by not addint any options at this point. Use [`{dplyr}`](https://dplyr.tidyverse.org/) for data manipulation and [`{ggplot2}`](https://ggplot2.tidyverse.org/) for data visualization.\n\n## 3. Spatial aspect of the migration data\n\nApart from the histograms, scatterplots or other plots, it is also useful to look at your data on a map like so:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshiny::tags$iframe(src = \"media/interactive/flowmap_widget.html\", width = \"100%\", height = \"600px\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<iframe src=\"media/interactive/flowmap_widget.html\" width=\"100%\" height=\"600px\"></iframe>\n```\n\n:::\n:::\n\n\n\n\n\nThe data in the Scholarly Migration Database does not contain coordinates, but has country names and their [ISO codes](https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes){target=\"_blank\"}. So you can combine this data with some other datasource that coordinates or boundaries for countries and their ISO codes.\n\n### 3.1 Packages for spatial data and flow mapping\n\nHere is a list of packages that you need to map the migration data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npackages <- c(\n  \"sf\", # for working with spatial data\n  \"spData\", # to easily get world boundaires\n  \"countrycode\", # to convert between iso2 and iso3 country codes\n  \"flowmapblue\", # for interactive flow mapping\n  \"flowmapper\" # for static flow mapping using ggplot2\n  )\ninstall.packages(packages)\n```\n:::\n\n\n\n\n**Note:** You only need to install the pacakges once, do not keep the code to install the packages in your Quarto document, at least not as it is presented above. This code does NOT check if the packages are already installed. So if you keep this code in your Quarto document, the listed packages will be downloaded every time you render the document into `html`, `pdf`, or any other format.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(spData)\nlibrary(countrycode)\nlibrary(flowmapblue)\nlibrary(flowmapper)\n\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n\n\n### 3.2. How to prepare the data for flow mapping\n\nFor mapping the flows you will need the coorindates of the countries.\n\nAn easy way to create these coordinates is by getting the data on country boundaries from the [`{spData}`](https://jakubnowosad.com/spData/){target=\"_blank\"} package:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries <- spData::world\nglimpse(countries)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 177\nColumns: 11\n$ iso_a2    <chr> \"FJ\", \"TZ\", \"EH\", \"CA\", \"US\", \"KZ\", \"UZ\", \"PG\", \"ID\", \"AR\", …\n$ name_long <chr> \"Fiji\", \"Tanzania\", \"Western Sahara\", \"Canada\", \"United Stat…\n$ continent <chr> \"Oceania\", \"Africa\", \"Africa\", \"North America\", \"North Ameri…\n$ region_un <chr> \"Oceania\", \"Africa\", \"Africa\", \"Americas\", \"Americas\", \"Asia…\n$ subregion <chr> \"Melanesia\", \"Eastern Africa\", \"Northern Africa\", \"Northern …\n$ type      <chr> \"Sovereign country\", \"Sovereign country\", \"Indeterminate\", \"…\n$ area_km2  <dbl> 19289.97, 932745.79, 96270.60, 10036042.98, 9510743.74, 2729…\n$ pop       <dbl> 885806, 52234869, NA, 35535348, 318622525, 17288285, 3075770…\n$ lifeExp   <dbl> 69.96000, 64.16300, NA, 81.95305, 78.84146, 71.62000, 71.039…\n$ gdpPercap <dbl> 8222.2538, 2402.0994, NA, 43079.1425, 51921.9846, 23587.3375…\n$ geom      <MULTIPOLYGON [°]> MULTIPOLYGON (((-180 -16.55..., MULTIPOLYGON ((…\n```\n\n\n:::\n:::\n\n\n\n\n\nSo this spatial data is just like a regular `data.frame`/`tibble`, but with an extra column with geometry data. Therefore, you can plot this data using `ggplot2`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries |> \n  ggplot() +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](task-01_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\nYou can also include several layers in the same plot:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = countries) +\n  geom_sf(data = st_centroid(countries), color = \"darkred\")\n```\n\n::: {.cell-output-display}\n![](task-01_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\nFor flow mapping, you only one point per country, so you only need a center (or more formally a 'centroid') of each country's polygon. Here is how you can do it:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries_centroids <- countries |> \n  st_centroid() |> # finds a center of each country'spolygon\n  st_coordinates() |>  # extracts numeric coorindates from the POINT geometry\n  as.data.frame() |> # converts the matrix to a data.frame \n  setNames(c(\"lon\", \"lat\")) |> # renames the columns\n  cbind(countries) |> # adds back all the columns (except for geometry) form `countries`\n  select(iso_a2, lon, lat, name_long) # only selects a few columns that we really need\n\nglimpse(countries_centroids)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 177\nColumns: 4\n$ iso_a2    <chr> \"FJ\", \"TZ\", \"EH\", \"CA\", \"US\", \"KZ\", \"UZ\", \"PG\", \"ID\", \"AR\", …\n$ lon       <dbl> 178.56842, 34.74198, -12.18574, -96.39551, -103.57290, 67.23…\n$ lat       <dbl> -17.3156217, -6.2505643, 24.2783849, 60.4767578, 44.7559814,…\n$ name_long <chr> \"Fiji\", \"Tanzania\", \"Western Sahara\", \"Canada\", \"United Stat…\n```\n\n\n:::\n:::\n\n\n\n\nYou may freely reuse this code above in your Quarto report.\n\nThe data format you get is ideal for both [`{flowmapblue}`](https://flowmapblue.github.io/flowmapblue.R/){target=\"_blank\"} and [`{flowmapper}`](https://github.com/JohMast/flowmapper) packages. You only need to tweak the column names of the `countries_centroids` `data.frame` before using it with either of these packages. You can see relevant package documentation for more details. Alternatively, you can follow tutorials for [`{flowmapper}`](https://ropenspain.github.io/spanishoddata/articles/flowmaps-static.html#reshape-flows-for-visualization){target=\"_blank\"} and [`{flowmapblue}`](https://ropenspain.github.io/spanishoddata/articles/flowmaps-interactive.html#prepare-data-for-visualization){target=\"_blank\"}.\n\n### 3.3. Country codes\n\nYou will find that the country code data in the Scholarly Migration Database does not match with the country names in the `countries` `data.frame`. Scholarly migration database uses ISO 3166-1 alpha-3 codes, and `countrycode` uses the ISO 3166-1 alpha-2 codes. So you need to convert the country names in the `countries` `data.frame` to ISO 3166-1 alpha-3 codes.\n\nYou can do this conversion using the `countrycode` package like so:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(countrycode)\n\n# assuming your data.frame is called `scopus_country_flows`\nscopus_country_flows <- scopus_country_flows |> \n  mutate(\n    iso2codefrom = countrycode(iso3codefrom,\n      origin = \"iso3c\",\n      destination = \"iso2c\"),\n    iso2codeto = countrycode(iso3codeto,\n      origin = \"iso3c\",\n      destination = \"iso2c\")\n  )\n```\n:::\n\n\n\n\n\n\n### 3.4. Hints on plotting the flows\n\n#### `{flowmapper}`\n\nTo plot the flows statically with `{flowmapper}`, you only need a regular code chunk, same as you would have for a `ggplot2` plot.\n\nFeel free to adapt [this tutorial](https://ropenspain.github.io/spanishoddata/articles/flowmaps-static.html){target=\"_blank\"}, but use the Scholarly Migration Database data instead of the mobility data used there.\n\n#### `{flowmapblue}`\n\nTo create interactive flow maps with the `{flowmapblue}`, you will need a free MapBox account. Feel free to adapt [this tutorial](https://ropenspain.github.io/spanishoddata/articles/flowmaps-interactive.html){target=\"_blank\"}, but use the Scholarly Migration Database data instead of the mobility data used there.\n\nTo include the interactive plot with `{flowmapblue}`, you may need a somewhat more sophisticated code chunk. See the instructions below.\n\nIf you created an interactive flowmap like so:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflowmap <- flowmapblue(locations = locations, flows = flows, mapboxAccessToken = mapbox_access_token)\n```\n:::\n\n\n\n\nBut simply printing the `flowmap` object in a code block breaks your entire Quarto document, here is what you need to do.\n\nSave the `flowmap` to an `html` file:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhtmlwidgets::saveWidget(flowmap, \"flowmap.html\")\n```\n:::\n\n\n\n\nThen include the `html` file in your Quarto document like so:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(shiny)\nshiny::tags$iframe(src = \"flowmap_widget.html\", width = \"100%\", height = \"600px\")\n```\n:::\n\n\n\n\n## 4. Create your final document\n\nOnce you have figured out which summary plots and which flow map you would like to include in your final document, create a copy of your draft document that you were working with and clean it up. Only keep the code that you absolutely need for the document to be rendered without errors. Name this copy `index.qmd`.\n\nAdjust the code visibility in your final document to your liking, using the Quarto documentation on [HTML blokcs](https://quarto.org/docs/output-formats/html-code.html){target=\"_blank\"} and [code execution](https://quarto.org/docs/computations/execution-options.html){target=\"_blank\"}.\n\nCreate a file named `_quarto.yaml` in the root of the repository and add the following to it:\n\n\n\n\n::: {.cell}\n\n```{.yaml .cell-code}\nproject:\n  output-dir: docs\n```\n:::\n\n\n\n\nMake sure you respect the indentation (i.e. number of tabs/spaces before `output-dir`) of the YAML file.\n\nThen render your final Quarto document into an `html` file, it should end up in the `docs` folder with the name `index.html`.\n\n## 5. Save changes and push them to GitHub\n\nYou can edit and save the files in your repository as much as you want locally. However, to save a certain clean version of your code or document to the git repository and upload it to GitHub, you also need to `commit` these changes. `commit` command \"bakes\" the changes you made to any files you edited permanently in the repository history. It is like a checkpoint for \"undo\" and \"redo\". A brief overview of the `git` workflow is well summarized [here](https://uidaholib.github.io/get-git/3workflow.html), but will also be demoed and discussed in class.\n\n### 5.1. Before the first commit\n\nBefore the first commit, you need to execute a few commands in terminal (you can do it either in system terminal or simply in RStudio built-in terminal).\n\n![Opening RStudio terminal](media/images/new-terminal-rstudio.png)\n\n```bash\ngit config --global user.name 'Your Name'\ngit config --global user.email 'you54385-2@345234543example.com'\n```\n\n![Setting the name and email in RStudio terminal](media/images/set-git-username-email.png)\n\n\nBeware which name and email you set there. The name and email are public in `git` to attribute contributions to specific individuals, to ensure transparency and accountability. The email does not have to be the same email that you used to sign up for GitHub. It can even be a non-existing email. However this email will be publicly available. It will not be visible on the GitHub website, but anyone who clonse a public repository will be able to see it with a `git log` command:\n\n![Beware that your name and email are public (viewed in terminal)](media/images/git-username-email-exposed.png)\n\n![Beware that your name and email are public (viewed in RStudio git history explorer)](media/images/git-username-email-exposed-rstudio.png)\n\n### 5.2. First commit\n\nTo save your changes to the local `git` repository that you have open in `RStudio`, find the `Git` panel in the top right and click the `Diff` button.\n\n![Git panel in RStudio](media/images/rstudio-commit-001.png)\n\nThis will open a new window where you can preview changes in the files that you made since last commit (which in this case was made by the author of the original repository, since you have just forked it).\n\n![Review changes window in RStudio and commit](media/images/rstudio-commit-002.png)\n\nHere you can select files that had changes or that were newly created or deleted. You can preview changes and select files that you want to save (commit) and later upload to GitHub (via `Push`). You can select one or more files to be `staged`, and only these files will be committed when you click the `Commit` button. Also, add a comment to your commit dsecribing the changes.\n\n\nAfter clicking the \"Commit\" button, you will see this screen.\n\n![Changes commited](media/images/rstudio-commit-003.png)\n\n\nClose this window and upload your commited changes to GitHub by clicking the \"Push\" button.\n\n![Commit window in RStudio](media/images/rstudio-commit-004.png)\n\nYou will see the upload screen:\n\n![Git push window in RStudio](media/images/rstudio-commit-005.png)\n\nYou can now close this window and the review changes window, and go to your GitHub repository to see the changes.\n\n### 5.3. Publish the html file\n\nOnce you have an `index.html` file in the `docs` folder, you can go to the repository settings and publish it to the web.\n\n![Publish via GitHub Pages](media/images/gh-pages-setup.png)\n\nYou will need to wait a few minutes. You only have one page, so it should not take too long. Reload the settings page and you should see your web link:\n\n![Website published](media/images/gh-pages-setup-done.png)\n\nYou can also go to your repository homepage and add this link in the right side of the repository page:\n\n![Repository view settings](media/images/gh-pages-link.png)\n\n\n\n## 6. Submit\n\nPost the link to your repository and/or website in `Issues` of this repository:\n[https://github.com/e-kotov/2024-EDSD-open-science-quarto-github/issues](https://github.com/e-kotov/2024-EDSD-open-science-quarto-github/issues){target=\"_blank\"}\n",
    "supporting": [
      "task-01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}